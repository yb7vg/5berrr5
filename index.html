<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إعداد مياه القهوة</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      direction: rtl;
      background-color: #f4f4f4;
      color: #333333;
    }
    .container {
      display: none;
      margin: 20px auto;
      padding: 20px;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      border: 3px solid #e0e0e0;
    }
    .container.active {
      display: block;
    }
    .header {
      font-size: 2em;
      font-weight: bold;
      color: #333;
      padding: 20px 0;
      text-align: center;
      background: #ffffff;
      border-bottom: 3px solid #e0e0e0;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #e0e0e0;
    }
    button {
      background: #f5f5f5;
      color: #333333;
      cursor: pointer;
      font-weight: bold;
      border: 1px solid #e0e0e0;
    }
    button:hover {
      background: #e0e0e0;
    }
    .result, .effects, .overall {
      margin: 10px 0;
      font-size: 1.1em;
      font-weight: bold;
    }
    .effects p, .result p, .overall p {
      color: #666666;
    }
  </style>
</head>
<body>

  <!-- اسم "خبير" في الجزء العلوي -->
  <div class="header">
    <span>خبير</span>
  </div>

  <!-- الصفحة الرئيسية -->
  <div id="mainMenu" class="container active">
    <h2>إعداد مياه القهوة</h2>
    <button onclick="showPage('waterSetup')">بدء الإعداد</button>
  </div>

  <!-- صفحة إعداد المياه -->
  <div id="waterSetup" class="container">
    <h2>إعداد المياه</h2>
    
    <label for="recipeSelect">اختر الوصفة:</label>
    <select id="recipeSelect" onchange="loadRecipe()">
      <option value="custom">وصفة مخصصة</option>
      <option value="moonlight">Moonlight</option>
      <option value="sunrise">Sunrise</option>
      <option value="ocean">Ocean</option>
      <option value="hinDown1">Hin Down 1</option>
      <option value="hinDown2">Hin Down 2</option>
      <option value="barista">Barista</option>
    </select>

    <label for="liters">عدد اللترات:</label>
    <input type="number" id="liters" value="1" min="0.1" step="0.1">

    <label for="mg">المغنيسيوم (mg):</label>
    <input type="number" id="mg" step="0.001">

    <label for="na">الصوديوم (na):</label>
    <input type="number" id="na" step="0.001">

    <div class="effects" id="recipeNotice"></div>
    <div class="result" id="resultsMinerals"></div>
    <div class="overall" id="overallAcceptability"></div>

    <button onclick="goHome()">الرجوع</button>
  </div>

  <script>
    function showPage(page) {
      document.querySelectorAll(".container").forEach(el => el.classList.remove("active"));
      document.getElementById(page).classList.add("active");
    }
    function goHome() {
      showPage("mainMenu");
    }

    function loadRecipe() {
      var recipe = document.getElementById("recipeSelect").value;
      let mgInput = document.getElementById("mg");
      let naInput = document.getElementById("na");
      let litersInput = document.getElementById("liters");

      const recipes = {
        moonlight: { mg: 0.089, na: 0.025, description: "Moonlight يضيف لمسة من الحموضة المعتدلة مع توازن الفاكهة." },
        sunrise: { mg: 0.049, na: 0.134, description: "Sunrise يزيد الفاكهية ويخفف من المرارة مع تأثيرات ليمونية." },
        ocean: { mg: 0.148, na: 0.151, description: "Ocean يعطي إحساسًا قويًا بالحموضة والمنعش." },
        hinDown1: { mg: 0.243, na: 0.034, description: "Hin Down 1 يضيف توازن بين الحموضة والمرارة مع نكهة غنية." },
        hinDown2: { mg: 0.243, na: 0.052, description: "Hin Down 2 مشابه ولكن يضيف مرارة أعمق." },
        barista: { mg: 0.197, na: 0.067, description: "Barista يوفر طعمًا متوازنًا مع لمسة من الفاكهية." }
      };

      if (recipe === "custom") {
        mgInput.disabled = false;
        naInput.disabled = false;
        mgInput.value = "";
        naInput.value = "";
        document.getElementById("recipeNotice").innerHTML = "يمكنك تعديل الوصفة المخصصة.";
      } else {
        let liters = parseFloat(litersInput.value) || 1;
        mgInput.disabled = true;
        naInput.disabled = true;
        mgInput.value = (recipes[recipe].mg * liters).toFixed(3);
        naInput.value = (recipes[recipe].na * liters).toFixed(3);
        document.getElementById("recipeNotice").innerHTML = recipes[recipe].description;
      }
      calculateMinerals();
    }

    document.getElementById("liters").addEventListener("input", loadRecipe);
    document.getElementById("mg").addEventListener("input", calculateMinerals);
    document.getElementById("na").addEventListener("input", calculateMinerals);

    function calculateMinerals() {
      let mg = parseFloat(document.getElementById("mg").value) || 0;
      let na = parseFloat(document.getElementById("na").value) || 0;
      let liters = parseFloat(document.getElementById("liters").value) || 1;

      let ghResult = (mg * (98.7 / 0.243)) / liters; // حساب GH (عسر الماء)
      let khResult = (na * (20.3 / 0.034)) / liters; // حساب KH (القلوية)

      document.getElementById("resultsMinerals").innerHTML = 
        `<p>عسر الماء العام (GH): ${ghResult.toFixed(1)}</p>
         <p>القلوية (KH): ${khResult.toFixed(1)}</p>`;

      // تقديم تأثير المغنيسيوم والصوديوم مرة واحدة فقط
      let effects = '';
      if (mg > 0) {
        effects += "<p>المغنيسيوم يمكن أن يضيف طابعًا حامضيًا معتدلًا وتوازنًا في النكهات.</p>";
      }
      if (na > 0) {
        effects += "<p>الصوديوم قد يخفف من المرارة ويضيف نكهة أكثر حلاوة.</p>";
      }
      document.getElementById("recipeNotice").innerHTML = effects;

      // تقييم الصلاحية بناءً على قيم GH و KH
      let waterStatus = "صالح";
      let waterColor = "#4CAF50"; // اللون الأخضر يعني صالح

      if (ghResult > 100 || khResult > 100) {
        waterStatus = "غير صالح للقهوة";
        waterColor = "#D32F2F"; // اللون الأحمر يعني غير صالح
      }

      document.getElementById("overallAcceptability").innerHTML = 
        `<p style="color: ${waterColor};">${waterStatus}</p>`;
    }
  </script>
</body>
</html>
